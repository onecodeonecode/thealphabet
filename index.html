<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner to Excel</title>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Quagga/0.12.1/quagga.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        #scanner-container {
            width: 100%;
            max-width: 600px;
            margin: auto;
        }
    </style>
</head>
<body class="text-center p-4">
    <h2>Scan a Barcode and Save to Excel</h2>
    <div id="scanner-container"></div>
    <button class="btn btn-primary mt-3" id="start-btn">Start Scanning</button>
    <button class="btn btn-success mt-3" id="export-btn">Export to Excel</button>
    <ul id="barcode-list" class="list-group mt-3"></ul>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let scannedCodes = [];
            let scannerStarted = false;

            document.getElementById("start-btn").addEventListener("click", function () {
                if (!scannerStarted) {
                    startScanner();
                    scannerStarted = true;
                }
            });

            document.getElementById("export-btn").addEventListener("click", function () {
                exportToExcel();
            });

            function startScanner() {
                if (typeof Quagga === "undefined") {
                    console.error("QuaggaJS failed to load.");
                    return;
                }

                Quagga.init({
                    inputStream: {
                        type: "LiveStream",
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment"
                        },
                        target: document.querySelector("#scanner-container")
                    },
                    decoder: {
                        readers: ["ean_reader", "code_128_reader", "upc_reader", "code_39_reader"]
                    }
                }, function (err) {
                    if (err) {
                        console.error("Quagga initialization error:", err);
                        return;
                    }
                    Quagga.start();
                });

                Quagga.onDetected(function (result) {
                    let code = result.codeResult.code;
                    if (!scannedCodes.includes(code)) {
                        scannedCodes.push(code);
                        let li = document.createElement("li");
                        li.textContent = code;
                        li.classList.add("list-group-item");
                        document.querySelector("#barcode-list").appendChild(li);
                    }
                });
            }

            function exportToExcel() {
                if (scannedCodes.length === 0) {
                    alert("No scanned barcodes to export.");
                    return;
                }
                let ws = XLSX.utils.aoa_to_sheet([["Scanned Barcodes"], ...scannedCodes.map(code => [code])]);
                let wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Barcodes");
                XLSX.writeFile(wb, "Scanned_Barcodes.xlsx");
            }
        });
    </script>
</body>
</html>

